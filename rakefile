
require 'rubygems'
require 'rubygems/package'
include FileUtils

MINOR_VERSION = ENV['GO_PIPELINE_LABEL'] || "pre#{Time.now.tv_sec}"

desc 'Clean temporary files'
task :clean do
  rm FileList['*.gem']
end

desc 'Build Gem'
task :build do
  spec = Gem::Specification.new do |s|
    s.name           = 'autostacker24'
    s.authors        = ['Johannes Mueller', 'Christian Rodemeyer']
    s.email          = %w(jmueller@autoscout24.com crodemeyer@autoscout24.com)
    s.homepage       = 'https://github.com/AutoScout24/autostacker24'
    s.summary        = 'Library for managing AWS CloudFormation stacks'
    s.description    = 'n/a'
    s.license        = 'MIT'
    s.files          = FileList['lib/**/*']
    s.version        = "1.0.#{MINOR_VERSION}"
    s.add_dependency 'aws-sdk', '~> 2.0.pre'
  end
  Gem::Package.build(spec)
end

task :publish do
  key = ENV['RUBYGEMSKEY']
  if key
    File.write(File.expand_path('~/.gem/credentials'), ":rubygems_api_key: #{key}")
  end

  gem = FileList['*.gem'].first
  puts "gem push #{gem}"
  puts `gem push #{gem}`
end


task :default => [:clean, :build]

